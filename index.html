<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Persoane - Bază de Date</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 20px;
            background-color: #f8f9fa;
        }
        .header {
            background-color: #343a40;
            color: white;
            padding: 30px 0;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
        }
        .stats-card {
            transition: transform 0.3s;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        .chart-container {
            height: 300px;
        }
        .footer {
            margin-top: 40px;
            padding: 20px 0;
            background-color: #343a40;
            color: #f8f9fa;
            border-radius: 10px;
        }
        .gender-m {
            color: #1e88e5;
        }
        .gender-f {
            color: #e91e63;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header text-center">
            <h1><i class="fas fa-database"></i> Management Persoane</h1>
            <p class="lead">Bază de date cu informații despre persoane</p>
        </div>

        <div id="loading">
            <p class="text-center">Se încarcă datele...</p>
            <div class="loader"></div>
        </div>

        <div id="content" style="display: none;">
            <!-- Statistici -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card stats-card bg-primary text-white">
                        <div class="card-body text-center">
                            <h5 class="card-title"><i class="fas fa-users"></i> Total Persoane</h5>
                            <h2 id="totalPersoane">0</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card stats-card bg-info text-white">
                        <div class="card-body text-center">
                            <h5 class="card-title"><i class="fas fa-calendar-alt"></i> Vârsta Medie</h5>
                            <h2 id="varstaMedia">0</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card stats-card bg-success text-white">
                        <div class="card-body text-center">
                            <h5 class="card-title"><i class="fas fa-venus-mars"></i> Raport M/F</h5>
                            <h2 id="raportMF">0% / 0%</h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grafic distribuție -->
            <div class="card mb-4">
                <div class="card-header bg-dark text-white">
                    <h5><i class="fas fa-chart-pie"></i> Distribuție pe sexe</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <canvas id="genderChart" class="chart-container"></canvas>
                        </div>
                        <div class="col-md-6">
                            <canvas id="ageChart" class="chart-container"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabel persoane -->
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5><i class="fas fa-table"></i> Lista Persoane</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="persoaneTabel">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>Nume</th>
                                    <th>Email</th>
                                    <th>Data Nașterii</th>
                                    <th>Vârstă</th>
                                    <th>Telefon</th>
                                    <th>Sex</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Date vor fi încărcate dinamic -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Raport -->
            <div class="card mt-4">
                <div class="card-header bg-dark text-white">
                    <h5><i class="fas fa-file-alt"></i> Raport Detaliat</h5>
                </div>
                <div class="card-body">
                    <pre id="raportText" class="bg-light p-3 rounded"></pre>
                </div>
            </div>
        </div>

        <div class="footer text-center">
            <p>Aplicație dezvoltată cu C# și SQLite | <i class="fas fa-code"></i> GitHub Pages</p>
            <p>Data ultimei actualizări: <span id="lastUpdate"></span></p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Încarcă datele
            loadData();
            
            // Setează data ultimei actualizări
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ro-RO');
        });

        async function loadData() {
            try {
                // Încarcă fișierul JSON cu persoane
                const response = await fetch('persoane.json');
                if (!response.ok) {
                    throw new Error('Nu s-a putut încărca fișierul JSON');
                }
                
                const persoane = await response.json();
                
                // Încarcă fișierul de raport
                const raportResponse = await fetch('raport.txt');
                if (raportResponse.ok) {
                    const raportText = await raportResponse.text();
                    document.getElementById('raportText').textContent = raportText;
                }

                // Afișează datele
                displayData(persoane);
                
                // Ascunde indicator încărcare și afișează conținut
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (error) {
                console.error('Eroare la încărcarea datelor:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> Eroare la încărcarea datelor. Detalii: ${error.message}
                    </div>
                `;
            }
        }

        function displayData(persoane) {
            // Actualizează statistici
            document.getElementById('totalPersoane').textContent = persoane.length;
            
            // Calculează vârsta medie
            const varstaTotal = persoane.reduce((sum, p) => sum + calculateAge(p.dataNasterii), 0);
            const varstaMedia = persoane.length > 0 ? (varstaTotal / persoane.length).toFixed(1) : 0;
            document.getElementById('varstaMedia').textContent = varstaMedia;
            
            // Calculează raport M/F
            const nrBarbati = persoane.filter(p => p.sex.toLowerCase() === 'm').length;
            const nrFemei = persoane.filter(p => p.sex.toLowerCase() === 'f').length;
            const procentajBarbati = persoane.length > 0 ? ((nrBarbati / persoane.length) * 100).toFixed(1) : 0;
            const procentajFemei = persoane.length > 0 ? ((nrFemei / persoane.length) * 100).toFixed(1) : 0;
            document.getElementById('raportMF').textContent = `${procentajBarbati}% / ${procentajFemei}%`;
            
            // Populează tabelul
            const tbody = document.querySelector('#persoaneTabel tbody');
            tbody.innerHTML = '';
            
            persoane.forEach(persoana => {
                const row = document.createElement('tr');
                
                const varsta = calculateAge(persoana.dataNasterii);
                const sexIcon = persoana.sex.toLowerCase() === 'm' ? 
                    '<i class="fas fa-male gender-m"></i>' : 
                    '<i class="fas fa-female gender-f"></i>';
                
                row.innerHTML = `
                    <td>${persoana.id}</td>
                    <td>${persoana.nume}</td>
                    <td><a href="mailto:${persoana.email}">${persoana.email}</a></td>
                    <td>${formatDate(persoana.dataNasterii)}</td>
                    <td>${varsta}</td>
                    <td><a href="tel:${persoana.numarTelefon}">${persoana.numarTelefon}</a></td>
                    <td>${sexIcon} ${persoana.sex.toUpperCase()}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Generează grafice
            createGenderChart(nrBarbati, nrFemei);
            createAgeChart(persoane);
        }

        function calculateAge(dateString) {
            const today = new Date();
            const birthDate = new Date(dateString);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
            return new Date(dateString).toLocaleDateString('ro-RO', options);
        }

        function createGenderChart(nrBarbati, nrFemei) {
            const ctx = document.getElementById('genderChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Bărbați', 'Femei'],
                    datasets: [{
                        data: [nrBarbati, nrFemei],
                        backgroundColor: ['#1e88e5', '#e91e63'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Distribuție pe sexe'
                        }
                    }
                }
            });
        }

        function createAgeChart(persoane) {
            const ageGroups = {
                '0-18': 0,
                '19-30': 0,
                '31-45': 0,
                '46-60': 0,
                '61+': 0
            };
            
            persoane.forEach(persoana => {
                const age = calculateAge(persoana.dataNasterii);
                if (age <= 18) ageGroups['0-18']++;
                else if (age <= 30) ageGroups['19-30']++;
                else if (age <= 45) ageGroups['31-45']++;
                else if (age <= 60) ageGroups['46-60']++;
                else ageGroups['61+']++;
            });
            
            const ctx = document.getElementById('ageChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(ageGroups),
                    datasets: [{
                        label: 'Număr persoane',
                        data: Object.values(ageGroups),
                        backgroundColor: '#6f42c1',
                        borderColor: '#6610f2',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Distribuție pe vârste'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
